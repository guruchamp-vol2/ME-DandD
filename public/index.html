<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>D&D Lobbies</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Styles -->
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <!-- App chrome -->
    <header class="appbar">
      <div class="brand">
        <div class="d20">20</div>
        <div>
          <div class="title">D&D Lobbies</div>
          <div class="subtitle">chat • dice • characters • mini-map • encounter • campaign</div>
        </div>
      </div>

      <div class="appbar-actions">
        <button id="themeToggle" class="btn icon" aria-label="Toggle theme" title="Toggle theme">
          <svg viewBox="0 0 24 24" class="icon-sun"><path d="M12 4V2m0 20v-2M4 12H2m20 0h-2M5.64 5.64 4.22 4.22m15.56 15.56-1.42-1.42M18.36 5.64 19.78 4.22M4.22 19.78l1.42-1.42" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></svg>
          <svg viewBox="0 0 24 24" class="icon-moon"><path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79Z" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/></svg>
        </button>
        <a class="btn ghost" href="https://5e.tools/" target="_blank" rel="noopener">Rules</a>
      </div>
    </header>

    <main class="layout">
      <!-- Sidebar: Lobby + Users -->
      <aside class="panel glass">
        <h3 class="panel-title">Lobby</h3>
        <div class="vstack gap-8">
          <label class="field">
            <span>Your name</span>
            <input id="name" maxlength="24" placeholder="e.g. Aelar" />
          </label>
          <label class="field">
            <span>Lobby name</span>
            <input id="lobby" maxlength="40" placeholder="e.g. tavern" />
          </label>
          <div class="hstack gap-8">
            <input id="password" class="grow" placeholder="(optional) password" />
            <button id="joinBtn" class="btn primary">Join</button>
          </div>
          <button id="listBtn" class="btn ghost">List Lobbies</button>
          <ul id="lobbies" class="list"></ul>

          <div class="divider"></div>

          <div class="hstack space-between center">
            <h4 class="muted">Players</h4>
            <span id="gmBadge" class="chip">GM: —</span>
          </div>
          <div id="users" class="userbar"></div>
        </div>
      </aside>

      <!-- Main: Tabs + Content -->
      <section class="main glass">
        <nav class="tabs">
          <button class="tab-btn active" data-tab="chatTab">Chat</button>
          <button class="tab-btn" data-tab="diceTab">Dice</button>
          <button class="tab-btn" data-tab="charsTab">Characters</button>
          <button class="tab-btn" data-tab="mapTab">Map</button>
          <button class="tab-btn" data-tab="encTab">Encounter</button>
          <button class="tab-btn" data-tab="campTab">Campaign</button>
        </nav>

        <!-- Chat -->
        <div id="chatTab" class="panel-body active">
          <div id="log" class="log"></div>
          <div class="composer">
            <input id="msg" placeholder="Type message or /command…" />
            <button id="sendBtn" class="btn primary">Send</button>
          </div>
          <div class="hint">Tips: <code>/help</code>, <code>/w @name hello</code>, <code>/roll 4d6kh3</code></div>
        </div>

        <!-- Dice -->
        <div id="diceTab" class="panel-body">
          <div class="grid-2">
            <label class="field">
              <span>Expression</span>
              <input id="expr" placeholder="Try: d20, 3d6+2, 4d6kh3, adv, dis…" />
            </label>
            <div class="vstack end">
              <button id="rollBtn" class="btn primary xl">Roll</button>
            </div>
          </div>
          <div class="hint">Keep highest/lowest: <code>4d6kh3</code> / <code>4d6kl3</code>. Advantage: <code>adv</code>.</div>
        </div>

        <!-- Characters -->
        <div id="charsTab" class="panel-body">
          <h3 class="section-title">Create / Edit Character</h3>

          <div class="grid cols-1 cols-2@lg gap-12">
            <div class="vstack gap-12">
              <div class="grid-3 gap-8">
                <input id="c_name" class="w-100" placeholder="Character name (defaults to your user)" />
                <select id="c_archetype">
                  <option value="">(Preset)</option>
                  <option>Warrior</option><option>Rogue</option><option>Wizard</option><option>Cleric</option>
                </select>
                <select id="c_race">
                  <option>Human</option><option>Elf</option><option>Dwarf</option><option>Halfling</option>
                </select>
              </div>

              <div class="grid-6 sm-grid-3 gap-8">
                <input id="c_class" placeholder="Class" />
                <input id="c_level" type="number" min="1" max="20" value="1" />
                <input id="c_ac" type="number" min="1" max="30" value="10" />
                <input id="c_hp" type="number" min="0" max="1000" value="10" />
                <input id="c_maxHp" type="number" min="1" max="1000" value="10" />
                <input id="c_speed" type="number" min="0" max="120" value="30" />
              </div>

              <div class="abilities">
                <div class="abilities-head">
                  <div class="muted">27-Point Buy</div>
                  <span class="chip" id="pointsLeft">Points left: 27</span>
                </div>
                <div class="grid-6 sm-grid-3 gap-8">
                  <label class="ability"><span>STR</span><input id="ab_STR" type="number" min="8" max="15" value="8"></label>
                  <label class="ability"><span>DEX</span><input id="ab_DEX" type="number" min="8" max="15" value="8"></label>
                  <label class="ability"><span>CON</span><input id="ab_CON" type="number" min="8" max="15" value="8"></label>
                  <label class="ability"><span>INT</span><input id="ab_INT" type="number" min="8" max="15" value="8"></label>
                  <label class="ability"><span>WIS</span><input id="ab_WIS" type="number" min="8" max="15" value="8"></label>
                  <label class="ability"><span>CHA</span><input id="ab_CHA" type="number" min="8" max="15" value="8"></label>
                </div>
              </div>

              <input id="c_profs" placeholder="Proficiencies (comma-separated)" />
              <textarea id="c_traits" rows="2" placeholder="Traits & features"></textarea>
              <textarea id="c_notes" rows="3" placeholder="Notes, inventory…"></textarea>

              <div class="hstack gap-8">
                <button id="saveChar" class="btn primary">Save / Update</button>
                <button id="deleteChar" class="btn danger ghost">Delete</button>
              </div>
            </div>

            <div class="card">
              <h4 class="muted">All Characters</h4>
              <div class="table-wrap">
                <table class="table">
                  <thead><tr><th>Name</th><th>Race</th><th>Archetype</th><th>Lvl</th><th>AC</th><th>HP</th><th>Abilities</th></tr></thead>
                  <tbody id="charsTable"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Map -->
        <div id="mapTab" class="panel-body">
          <div class="toolbar">
            <div class="hstack wrap gap-8">
              <button class="btn ghost" id="gmSetMap">Set Map (GM)</button>
              <input class="w-10" id="mapW" type="number" value="20" min="5" max="60" />
              <input class="w-10" id="mapH" type="number" value="20" min="5" max="60" />
              <button class="btn ghost" id="gmClear">Clear Walls (GM)</button>
              <label class="toggle"><input type="checkbox" id="drawWalls"><span>Draw Walls</span></label>
              <label class="toggle"><input type="checkbox" id="eraseWalls"><span>Erase</span></label>
            </div>

            <div class="hstack wrap gap-8">
              <button class="btn ghost" id="addToken">Add My Token</button>
              <input id="tokenName" class="w-20" placeholder="Token name">
              <input id="tokenColor" type="color" value="#222222" class="color">
              <button id="removeToken" class="btn ghost">Remove Selected</button>
              <button class="btn ghost" id="pingBtn">Ping</button>
              <canvas id="miniCanvas" width="180" height="180" class="mini"></canvas>
            </div>
          </div>

          <div class="mapwrap">
            <canvas id="mapCanvas" width="1000" height="560" class="map"></canvas>
          </div>

          <div class="hint">GM toggles walls; players drag their tokens. Click a tile then “Ping”.</div>
        </div>

        <!-- Encounter -->
        <div id="encTab" class="panel-body">
          <div class="hstack wrap gap-8">
            <button id="encStart" class="btn ghost">Start Encounter (GM)</button>
            <button id="encNext" class="btn ghost">Next Turn (GM)</button>
            <button id="encEnd" class="btn ghost">End Encounter (GM)</button>
          </div>
          <div class="grid-3 gap-12 top-pad">
            <div class="card">
              <h4 class="muted">Initiative Order</h4>
              <div class="table-wrap">
                <table class="table">
                  <thead><tr><th>#</th><th>Name</th><th>Init</th></tr></thead>
                  <tbody id="initTable"></tbody>
                </table>
              </div>
            </div>
            <div class="card">
              <h4 class="muted">Set Initiative</h4>
              <div class="grid-3 gap-8">
                <input id="initName" placeholder="Name" />
                <input id="initVal" type="number" placeholder="Init" />
                <button id="setInit" class="btn primary">Set</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Campaign -->
        <div id="campTab" class="panel-body">
          <div class="grid cols-1 cols-2@lg gap-12">
            <div class="vstack gap-12">
              <div id="campMeta" class="card"></div>
              <div id="campScene" class="card"></div>
              <div id="campChoices" class="hstack wrap gap-8"></div>

              <div class="grid-2 gap-12">
                <div class="card">
                  <h4 class="muted">Handouts</h4>
                  <ul id="handouts" class="list"></ul>
                </div>
                <div class="card">
                  <h4 class="muted">Quests</h4>
                  <ul id="quests" class="list"></ul>
                </div>
              </div>

              <div class="card">
                <h4 class="muted">Session Notes</h4>
                <div id="notes" class="notes"></div>
                <div class="composer">
                  <input id="noteText" placeholder="Add a note…" />
                  <button id="addNote" class="btn">Add</button>
                </div>
              </div>
            </div>

            <div id="gmTools" class="card gm-tools" style="display:none;">
              <h3 class="section-title">GM Tools</h3>
              <div class="vstack gap-12">
                <div class="hstack gap-8">
                  <input id="campTitle" class="grow" placeholder="Campaign Title" />
                  <button id="saveCampMeta" class="btn primary">Save Title</button>
                </div>
                <div class="hstack gap-8">
                  <textarea id="campSummary" rows="2" class="grow" placeholder="Campaign Summary"></textarea>
                  <button id="saveCampSummary" class="btn">Save Summary</button>
                </div>
                <div class="divider"></div>

                <div class="grid-3 gap-8">
                  <input id="sceneTitle" placeholder="Scene title" />
                  <input id="sceneContent" placeholder="Scene content" />
                  <button id="addScene" class="btn">Add Scene</button>
                </div>
                <div class="hstack gap-8">
                  <input id="sceneIdSet" placeholder="Scene ID to set" />
                  <button id="setScene" class="btn">Set Current Scene</button>
                </div>
                <div class="grid-4 gap-8">
                  <input id="choiceSceneId" placeholder="Scene ID" />
                  <input id="choiceText" placeholder="Choice text" />
                  <input id="choiceTo" placeholder="Goto Scene ID" />
                  <button id="addChoice" class="btn">Add Choice</button>
                </div>
                <div class="divider"></div>

                <div class="grid-3 gap-8">
                  <input id="handoutTitle" placeholder="Handout title" />
                  <input id="handoutContent" placeholder="Handout content" />
                  <button id="addHandout" class="btn">Add Handout</button>
                </div>
                <div class="hstack gap-8">
                  <input id="questTitle" placeholder="Quest title" />
                  <button id="addQuest" class="btn">Add Quest</button>
                </div>
              </div>
            </div>
          </div>
        </div>

      </section>
    </main>

    <footer class="footer">
      <div class="muted">Create a lobby with a password to become GM. Build your story with scenes, choices, handouts, and quests.</div>
    </footer>

    <!-- Scripts: load Socket.IO first, then your app (only once each). -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="/client.js"></script>
  </body>
</html>
